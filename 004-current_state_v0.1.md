# 現状分析

**プロジェクト名**: Mindful Rhythm（マインドフル・リズム）
**作成日**: 2025年10月30日
**バージョン**: v0.1
**作成者**: Claude AI支援
**文書種別**: 現状分析（調査方針プロセス: ステップ6-1）

---

## 1. 分析の目的

本文書は、プロジェクトの**現状（AS-IS）を客観的に分析**し、要件定義の基礎資料とする。

**分析範囲**:
- 既存の要件定義書・画面設計図の完成度評価
- 定義済み機能の網羅性・具体性の確認
- 技術スタックの選定理由と妥当性
- 開発体制・スケジュールの実現可能性
- 研究価値の明確性

**分析方法**:
- 証拠資料（要件定義書.txt、画面設計図.txt）の詳細レビュー
- 調査方針との整合性確認
- 技術選定の根拠検証
- スコープ・制約の明確性評価

---

## 2. 既存資料の完成度評価

### 2.1 要件定義書.txt の分析

**ファイルパス**: `./要件定義書.txt`
**作成日**: 2025年10月23日
**セクション数**: 12セクション

#### 2.1.1 完成度評価（5段階）

| セクション | 完成度 | 評価 |
|-----------|--------|------|
| 1. 概要 | ⭐⭐⭐⭐⭐ | 背景・目的・コンセプトが明確 |
| 2. システム構成 | ⭐⭐⭐⭐ | 技術スタック定義済み、サーバー構成は未定義 |
| 3. 機能要件 | ⭐⭐⭐⭐ | 11機能リスト化、優先度は未明示 |
| 4. 非機能要件 | ⭐⭐⭐ | 6項目定義、具体的検証方法は不足 |
| 5. UI設計 | ⭐⭐⭐⭐ | 8画面構成明確、詳細は画面設計図に委譲 |
| 6. データ構造 | ⭐⭐⭐ | JSON例あり、スキーマ定義は簡略 |
| 7. 画面遷移図 | ⭐⭐⭐⭐ | 階層構造明確、ナビゲーション種別定義済み |
| 8. 開発体制 | ⭐⭐⭐⭐ | 3名の役割分担明確 |
| 9. 開発スケジュール | ⭐⭐⭐ | 3期に分割、週単位マイルストーンは不足 |
| 10. MVP | ⭐⭐⭐⭐⭐ | 5機能を最小実装範囲として明確化 |
| 11. 今後の拡張計画 | ⭐⭐⭐⭐ | 5項目を将来機能として列挙 |
| 12. 成功のポイント | ⭐⭐⭐⭐ | 4項目の方針明示 |

**総合評価**: ⭐⭐⭐⭐（4.0 / 5.0）

**強み**:
- 概要・目的・コンセプトが明確に定義されている
- MVPと拡張機能の区別が適切
- 画面遷移図が階層的に整理されている

**弱み**:
- 非機能要件の検証方法が具体的でない
- データ構造のスキーマ定義が簡略（型・制約が不明確）
- スケジュールの週単位マイルストーンが不足
- 研究価値（睡眠スコアアルゴリズム）の詳細が未記載

---

### 2.2 画面設計図.txt の分析

**ファイルパス**: `./画面設計図.txt`
**作成日**: 2025年10月23日
**版数**: v1.0
**セクション数**: 11セクション

#### 2.2.1 完成度評価（5段階）

| セクション | 完成度 | 評価 |
|-----------|--------|------|
| 0. 本書の目的 | ⭐⭐⭐⭐⭐ | 目的明確 |
| 1. 画面一覧 | ⭐⭐⭐⭐⭐ | 8画面 + 3モーダル完全リスト化 |
| 2. 共通仕様 | ⭐⭐⭐⭐⭐ | レイアウト・カラー・命名規則・状態・アクセシビリティを詳細定義 |
| 3. 画面詳細（3.1～3.8） | ⭐⭐⭐⭐⭐ | 全8画面の要素・バリデーション・遷移・データを詳細定義 |
| 4. モーダル詳細 | ⭐⭐⭐⭐⭐ | 3モーダルの仕様明確 |
| 5. 入出力仕様 | ⭐⭐⭐⭐⭐ | 主要フィールド定義（型・必須・検証・保存先） |
| 6. 例: 保存データ | ⭐⭐⭐⭐ | JSON例示、実際のDB構造は未定義 |
| 7. エラーハンドリング | ⭐⭐⭐⭐ | トースト文言例3件 |
| 8. 分析・イベント計測 | ⭐⭐⭐ | 将来機能として3イベント列挙 |
| 9. 受け入れ条件 | ⭐⭐⭐⭐⭐ | 画面ごとの具体的受入条件明示 |
| 10. 単体テスト観点 | ⭐⭐⭐⭐ | 4項目のテストケース例 |
| 11. 今後のUI追加候補 | ⭐⭐⭐ | 3機能を将来拡張として列挙 |

**総合評価**: ⭐⭐⭐⭐⭐（4.7 / 5.0）

**強み**:
- 画面設計が極めて詳細（要素ID・バリデーション・遷移・データバインディング完備）
- 共通仕様（命名規則・カラー・アクセシビリティ）が明確
- 受け入れ条件が具体的で実装時の指針として有効
- エラーハンドリング・テスト観点まで記載

**弱み**:
- データベーススキーマ（SQLite）の詳細設計が不足
- 将来機能（イベント計測）は計画段階

---

## 3. 技術スタック分析

### 3.1 選定済み技術

| カテゴリ | 技術 | 選定理由 | 妥当性評価 |
|---------|------|---------|----------|
| フレームワーク | React Native (Expo) | クロスプラットフォーム、学習コスト低 | ⭐⭐⭐⭐⭐ 適切 |
| データ保存 | SQLite / AsyncStorage | ローカル完結、オフライン対応 | ⭐⭐⭐⭐ 適切（スキーマ設計必要） |
| グラフ描画 | Recharts または Victory | React対応、豊富なグラフ種別 | ⭐⭐⭐⭐ 適切（最終選択必要） |
| センサー | 加速度・マイク・照度 | Expo Sensorsで利用可能 | ⭐⭐⭐ 要検証（精度・プライバシー） |
| ナビゲーション | React Navigation | React Native標準ライブラリ | ⭐⭐⭐⭐⭐ 適切 |

#### 3.1.1 React Native (Expo) の評価

**選定理由**:
- iOS/Android同時開発可能（開発効率2倍）
- 豊富なライブラリ・コミュニティ
- 初学者向け学習リソース充実
- Expo Goによる迅速なテスト環境

**制約・リスク**:
- 一部ネイティブモジュール利用不可（ExpoSDK範囲内に限定）
- センサー精度がネイティブより劣る可能性
- アプリサイズが大きくなる傾向

**妥当性**: ⭐⭐⭐⭐⭐（学生プロジェクトとして最適）

---

#### 3.1.2 SQLite の評価

**選定理由**:
- ローカル完結型（サーバー不要、コストゼロ）
- React Nativeで広く使用（expo-sqliteパッケージあり）
- リレーショナルDB（複雑なクエリ対応）

**制約・リスク**:
- スキーマ設計が未詳細（sleep_records, tasks等の型定義必要）
- データマイグレーション戦略が未定義
- バックアップ・復元機能が未計画

**妥当性**: ⭐⭐⭐⭐（適切だが詳細設計必要）

---

#### 3.1.3 センサーAPI の評価

**選定理由**:
- Expo Sensorsで加速度・マイク・照度が利用可能
- センサーフュージョンによる睡眠状態推定（研究価値）

**制約・リスク**:
- **加速度センサー**: 体動検知精度がデバイス依存
- **マイク**: いびき検知はプライバシー懸念（ユーザー許可必須）
- **照度センサー**: Android一部デバイスで非対応

**妥当性**: ⭐⭐⭐（研究として興味深いが精度検証必須）

**推奨事項**:
- MVP段階では手入力と併用
- センサー精度の文献調査・実験的検証
- プライバシーポリシー明記

---

### 3.2 未選定・要検討技術

| カテゴリ | 検討すべき技術 | 優先度 | 備考 |
|---------|--------------|--------|------|
| 状態管理 | Redux / Context API / Zustand | 中 | MVPでは不要、拡張時に検討 |
| 認証 | Firebase Auth / Supabase Auth | 低 | 将来のクラウド同期時に必要 |
| AI API | ChatGPT API / Gemini API | 中 | ルールベース → API移行を検討 |
| テスト | Jest / React Native Testing Library | 高 | 品質保証に必須 |
| CI/CD | GitHub Actions / Expo EAS Build | 中 | 自動ビルド・テストに有効 |

---

## 4. 機能要件の網羅性分析

### 4.1 定義済み機能（要件定義書.txt より）

| 機能区分 | 機能名 | 画面設計図 | 実装優先度 | 備考 |
|---------|--------|-----------|----------|------|
| 睡眠管理 | 睡眠記録 | ✅ 3.4 | MVP | 手入力 + センサー補助 |
| 睡眠管理 | 睡眠スコア計算 | ✅ 3.4 | MVP | アルゴリズム詳細未定義 |
| 睡眠管理 | 睡眠環境日記 | ✅ 4.2モーダル | MVP | タグ選択式 |
| 睡眠管理 | アドバイス提示 | ✅ 4.3モーダル | MVP | ルールベース |
| タスク管理 | ToDoリスト | ✅ 3.5 | MVP | CRUD操作 |
| タスク管理 | 感情付き完了 | ✅ 4.1モーダル | MVP | 6種類絵文字 |
| タスク管理 | 睡眠改善課題 | ✅ 3.5 | MVP | 毎日1件自動提示 |
| CBT-I支援 | 睡眠日記 | ✅ 3.7 | MVP | テキスト + 音声入力 |
| CBT-I支援 | AIインサイト | ⏳ 未詳細 | 拡張 | 相関分析機能 |
| UI/UX | キャラクター成長 | ✅ 3.3 | MVP | スリーピン表示 |
| ビジュアル | ホーム背景変化 | ✅ 3.3 | MVP | 太陽/月/曇り |
| グラフ分析 | スコア推移 | ✅ 3.6 | MVP | 週/月切替 |

**機能網羅性**: ⭐⭐⭐⭐（MVPは十分、拡張機能の詳細不足）

---

### 4.2 睡眠スコアアルゴリズムの現状

**定義状況**:
- **概念**: 0～100点で睡眠の質を評価
- **評価指標**: 睡眠時間、深睡眠比率、中途覚醒、入眠潜時、環境要因
- **算出式**: `score = Σ(各指標 × 重み)` と記載

**不足要素**:
- 各指標の具体的な重み係数（例: 睡眠時間 40%、深睡眠 30%...）
- 深睡眠比率の推定方法（加速度センサーからの変換式）
- 環境要因の加点/減点ルール（運動 +2点、カフェイン -4点 等）
- 文献的根拠（PSQI等の既存指標との対応）

**研究価値への影響**:
- **現状**: アルゴリズムの概念のみ定義
- **必要**: 文献調査による妥当性検証、重み係数の理論的根拠、実験的検証計画

**推奨事項**:
1. 睡眠評価指標の文献調査（PSQI, ISI等）
2. 重み係数の仮説設定（先行研究ベース）
3. 実験計画立案（10名程度の被験者で検証）
4. アルゴリズム詳細を技術仕様書に追記

---

## 5. 非機能要件の現状

### 5.1 定義済み非機能要件

| 項目 | 目標値 | 測定方法 | 現状評価 |
|------|--------|---------|---------|
| 起動速度 | 5秒以内 | Expo Performance Monitor | ⭐⭐⭐ 測定方法明確 |
| 操作レスポンス | 1秒以内 | 主要操作の実測 | ⭐⭐⭐ やや曖昧（「主要操作」の定義不足） |
| データ保存 | オフライン対応 | - | ⭐⭐⭐⭐ SQLiteで実現可能 |
| セキュリティ | 暗号化保存 | - | ⭐⭐ 具体的暗号化方式未定義 |
| UIデザイン | ダークトーン | - | ⭐⭐⭐⭐ カラーコード定義済み |
| 保守性 | モジュール管理 | - | ⭐⭐⭐ コンポーネント分割方針は簡略 |

**非機能要件の課題**:
- **パフォーマンス**: 「主要操作」の定義が不明確（どの操作を測定？）
- **セキュリティ**: 暗号化方式未定義（expo-secure-store? react-native-keychain?）
- **保守性**: コンポーネント分割の具体的方針不足
- **アクセシビリティ**: WCAG基準への準拠状況が未記載（画面設計図にはコントラスト比4.5:1と記載あり）
- **テスタビリティ**: テスト戦略・カバレッジ目標が未定義

---

### 5.2 追加すべき非機能要件

| カテゴリ | 追加項目 | 優先度 | 備考 |
|---------|---------|--------|------|
| パフォーマンス | データベースクエリ応答速度 | 高 | 1000件のレコードでも1秒以内 |
| パフォーマンス | メモリ使用量上限 | 中 | 200MB以下（バックグラウンド時） |
| セキュリティ | 暗号化方式明記 | 高 | expo-secure-storeでキー管理 |
| セキュリティ | プライバシーポリシー策定 | 高 | マイク利用時の明示的同意 |
| 可用性 | データバックアップ | 中 | JSON Export機能（設定画面に記載あり） |
| 保守性 | コードカバレッジ目標 | 中 | 70%以上（Jestで測定） |
| アクセシビリティ | スクリーンリーダー対応 | 低 | MVP外、将来対応 |

---

## 6. 開発体制・スケジュール分析

### 6.1 開発体制

| 役割 | 担当者 | 主な責務 | 評価 |
|------|--------|---------|------|
| PM | 増田 | 設計・進行管理 | ⭐⭐⭐⭐ 明確 |
| UI/UX | 藤川 | 画面設計・アニメーション | ⭐⭐⭐⭐ 明確 |
| エンジニア | 立川 | React Native実装・DB | ⭐⭐⭐⭐ 明確 |
| AI機能調査 | 全員 | ChatGPT/Gemini活用 | ⭐⭐⭐ やや曖昧 |

**評価**:
- 役割分担は明確
- 3名体制（小規模）で適切なスコープ
- Git/GitHubでのコード管理体制は未記載
- コードレビュー・ペアプログラミング等の協働方法が不明確

---

### 6.2 開発スケジュール

**要件定義書.txtの記載**:
- **第1期（10/9～10/27）**: React Native習得、UIモック作成
- **第2期（10/28～11/24）**: 睡眠記録・スコア・タスク実装
- **第3期（11/25～12/26）**: CBT-I機能追加・発表準備

**調査方針_v0.1.1.mdの記載**:
- **Week 1-2**: 環境構築・基礎学習 → M1: 環境完全構築
- **Week 3-4**: 超音波センサー障害物回避（※ロボット開発の記述？）
- **Week 5-6**: 画像認識実装（※ロボット開発の記述？）
- **Week 7**: 統合・最適化（バッファ週）
- **Week 8**: 最終調整・プレゼン準備

**齟齬・課題**:
- 調査方針のWeek 3-6が「ロボット開発」の記述になっている（コピーミス？）
- 実際の開発内容と整合性が不明
- 週単位マイルストーンの詳細が不足

**推奨事項**:
- 調査方針のWeek 3-6を本プロジェクト用に修正
- TodoList.mdの開発マイルストーンを基準に採用
- 各週の具体的な実装タスクを明確化

---

## 7. データ構造の現状

### 7.1 定義済みデータ

**要件定義書.txt（6. データ構造）**:
```json
{
  "sleep_records": [
    {
      "date": "2025-10-22",
      "bedtime": "23:30",
      "waketime": "06:45",
      "score": 82,
      "tags": ["運動", "カフェインなし"],
      "dream": "森を歩く夢",
      "mood": "😊"
    }
  ],
  "tasks": [
    {
      "date": "2025-10-22",
      "task": "寝る前にスマホを見ない",
      "status": "done",
      "emotion": "😌"
    }
  ]
}
```

**画面設計図.txt（2.5 データバインディング）**:
- `sleep_records(id, date, bedtime, waketime, score, tags, dream, mood)`
- `tasks(id, date, task, status, emotion)`
- `user_mood(id, date, morning_mood, night_mood)`
- `ai_advice(id, date, advice_text)`

**評価**:
- **一貫性**: 要件定義書と画面設計図で微妙に異なる（idフィールドの有無）
- **型定義不足**: 各フィールドのデータ型（string, int, datetime等）が不明確
- **制約不足**: 必須/任意、デフォルト値、外部キー関係が未定義
- **正規化**: user_moodテーブルとsleep_recordsの関係が不明確

---

### 7.2 データベーススキーマ設計の必要性

**現状**: JSON例示のみ、SQLiteスキーマ未定義

**必要な追加項目**:
1. **テーブル定義（DDL）**: CREATE TABLE文
2. **制約定義**: PRIMARY KEY, NOT NULL, UNIQUE, CHECK, FOREIGN KEY
3. **インデックス設計**: date列等の検索用インデックス
4. **初期データ**: マスタデータ（タスク課題リスト等）
5. **マイグレーション戦略**: バージョン管理・スキーマ更新方法

**推奨事項**:
- 技術仕様書でSQLiteスキーマを詳細定義
- expo-sqlite-ormやTypeORMの採用検討（型安全性向上）

---

## 8. 研究価値の現状評価

### 8.1 研究テーマの明確性

**要件定義書.txtの記載**:
- 「心理学（CBT-I）を応用した睡眠・感情・行動の相関分析」
- 「AIと心理学的理論を融合」

**調査方針_v0.1.1.mdの記載**:
- 「睡眠スコアなどを目標にしたいです」

**現状評価**: ⭐⭐⭐（方向性は明確だが具体性不足）

---

### 8.2 研究価値の3要素

| 要素 | 現状 | 必要な追加 |
|------|------|----------|
| **新規性** | センサーフュージョン方式の睡眠スコア算出 | 既存研究との差別化明示 |
| **有用性** | ユーザーの生活リズム改善支援 | 有効性検証の実験計画 |
| **妥当性** | CBT-I理論に基づく設計 | 睡眠スコアアルゴリズムの文献的根拠 |

**不足要素**:
1. **先行研究調査**: 既存の睡眠アプリ・睡眠評価指標との比較
2. **研究仮説**: 「センサーフュージョンによる睡眠スコアは自己報告式PSQIと0.7以上の相関」等
3. **実験計画**: 被験者数、期間、評価指標、統計手法
4. **予想される成果**: 論文・ポスター発表の具体的内容

---

## 9. 現状の強み・弱み・機会・脅威（SWOT分析）

### 9.1 強み（Strengths）

1. **詳細な画面設計**: 8画面 + 3モーダルが極めて詳細に設計済み
2. **MVPの明確性**: 最小実装範囲が明確で実現可能
3. **技術選定の妥当性**: React Native (Expo) は学生プロジェクトに最適
4. **役割分担の明確性**: 3名の役割が明確で責任範囲が重複しない
5. **研究テーマの興味深さ**: CBT-I + センサーフュージョンは学術的に価値あり

---

### 9.2 弱み（Weaknesses）

1. **睡眠スコアアルゴリズムの詳細不足**: 研究の中核が未定義
2. **非機能要件の具体性不足**: セキュリティ・パフォーマンス・保守性の詳細不明
3. **データベーススキーマ未設計**: SQLiteテーブル定義が不足
4. **スケジュール詳細不足**: 週単位の具体的タスクが不明確
5. **テスト戦略未定義**: 品質保証の方針が不明

---

### 9.3 機会（Opportunities）

1. **AI支援ツールの活用**: ChatGPT/Claude Codeで開発効率向上
2. **Expoエコシステムの充実**: 必要なライブラリがほぼ揃っている
3. **CBT-I研究の活発化**: 睡眠障害治療のホットトピック
4. **ウェアラブル連携の将来性**: Apple Watch等との連携拡張可能

---

### 9.4 脅威（Threats）

1. **学習曲線の急峻さ**: React Native初学者が8週間で完成させる難度
2. **センサー精度の不確実性**: 加速度センサーの睡眠推定精度が低い可能性
3. **スケジュール遅延リスク**: Week 7のバッファが不十分な可能性
4. **研究価値の証明困難**: 妥当性検証に時間・リソース不足

---

## 10. 現状の定量評価

| 評価項目 | 完成度 | 評価 |
|---------|--------|------|
| **要件定義の網羅性** | 70% | 機能要件は十分、非機能要件不足 |
| **画面設計の詳細性** | 95% | 実装可能レベル |
| **技術仕様の具体性** | 40% | アルゴリズム・DB設計不足 |
| **開発計画の実現可能性** | 60% | スケジュール詳細不足 |
| **研究価値の明確性** | 50% | 方向性明確だが詳細不足 |
| **総合完成度** | **63%** | Phase 2（構造化分析）で80%目標 |

---

## 11. 次ステップへの提言

### 11.1 Phase 2（構造化分析）で実施すべき項目

1. **ギャップ分析（005-gap_analysis_v0.1.md）**:
   - 理想状態（完全な要件定義・研究価値の明確化）とのギャップ特定
   - 優先度付け

2. **実現可能性評価（006-feasibility_v0.1.md）**:
   - React Native (Expo) の技術制約詳細確認
   - センサーAPI精度の文献調査・実験計画
   - 8週間スケジュールの実現可能性シミュレーション

3. **価値評価（007-value_eval_v0.1.md）**:
   - 睡眠スコアアルゴリズムの研究価値検証
   - CBT-I理論の適用妥当性評価
   - 先行研究との差別化明確化

### 11.2 Phase 3（要件定義書作成）で追加すべき項目

1. **睡眠スコアアルゴリズム詳細**:
   - 各指標の重み係数（文献根拠付き）
   - センサーデータから深睡眠比率への変換式
   - 環境要因の加点/減点ルール

2. **データベーススキーマ**:
   - SQLite DDL（CREATE TABLE文）
   - 制約・インデックス定義
   - マイグレーション戦略

3. **非機能要件の詳細化**:
   - パフォーマンス測定方法
   - セキュリティ実装方式
   - テスト戦略・カバレッジ目標

4. **研究計画**:
   - 研究仮説
   - 実験計画（被験者・期間・評価指標）
   - 予想される成果

---

## 12. 文書管理情報

- **作成日**: 2025年10月30日
- **最終更新日**: 2025年10月30日
- **バージョン**: v0.1
- **次回更新予定**: ギャップ分析後（v0.2）
- **保管場所**: `/Users/matsulab/GitHub/Mindful_Rhythm/004-current_state_v0.1.md`
- **関連文書**:
  - [要件定義書.txt](./要件定義書.txt)
  - [画面設計図.txt](./画面設計図.txt)
  - [001-plan_v0.1.md](./001-plan_v0.1.md)
  - [003-evidence_log_v0.1.md](./003-evidence_log_v0.1.md)
  - [用語集.md](./用語集.md)
