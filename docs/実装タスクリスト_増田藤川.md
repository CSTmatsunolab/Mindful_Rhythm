# å®Ÿè£…ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ - å¢—ç”°ã•ã‚“ãƒ»è—¤å·ã•ã‚“æ‹…å½“

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: Mindful Rhythm
**ä½œæˆæ—¥**: 2025å¹´10æœˆ30æ—¥
**å¯¾è±¡æœŸé–“**: Week 3-6ï¼ˆã‚³ã‚¢æ©Ÿèƒ½å®Ÿè£…ï½æ‹¡å¼µæ©Ÿèƒ½å®Ÿè£…ï¼‰

---

## ğŸ“‹ ã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚µãƒãƒªãƒ¼

- **å¢—ç”°ã•ã‚“ï¼ˆç¡çœ ç®¡ç†æ‹…å½“ï¼‰**: 9ã‚¿ã‚¹ã‚¯
- **è—¤å·ã•ã‚“ï¼ˆã‚¿ã‚¹ã‚¯ç®¡ç†æ‹…å½“ï¼‰**: 8ã‚¿ã‚¹ã‚¯
- **å…±é€šã‚¿ã‚¹ã‚¯**: 3ã‚¿ã‚¹ã‚¯
- **åˆè¨ˆ**: 20ã‚¿ã‚¹ã‚¯

---

## ğŸ›ï¸ å¢—ç”°ã•ã‚“æ‹…å½“ã‚¿ã‚¹ã‚¯ï¼ˆç¡çœ ç®¡ç†æ©Ÿèƒ½ï¼‰

### 1. ç¡çœ ã‚¹ã‚³ã‚¢ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£… â­ï¸æœ€å„ªå…ˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/sleepScoreCalculator.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
// 5ã¤ã®æŒ‡æ¨™ã‹ã‚‰ç¡çœ ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—
export function calculateSleepScore(data: {
  bedtime: string;      // "22:30"
  waketime: string;     // "07:00"
  sleep_quality: 'ã‚ˆãçœ ã‚ŒãŸ' | 'æ™®é€š' | 'æµ…ã‹ã£ãŸ';
  awakenings: number;   // ä¸­é€”è¦šé†’å›æ•°
  sleep_latency: number; // å…¥çœ æ½œæ™‚ï¼ˆåˆ†ï¼‰
  tags: string[];       // ['é‹å‹•', 'ã‚«ãƒ•ã‚§ã‚¤ãƒ³ãªã—', 'å…¥æµ´']
}): number {
  // 1. ç¡çœ æ™‚é–“ã‚¹ã‚³ã‚¢ (30%)
  const totalHours = calculateTotalHours(bedtime, waketime);
  const sleepTimeScore = Math.min((totalHours / 7.0) * 100, 100);

  // 2. æ·±ç¡çœ ã‚¹ã‚³ã‚¢ (25%)
  const deepSleepScore = {
    'ã‚ˆãçœ ã‚ŒãŸ': 100,
    'æ™®é€š': 70,
    'æµ…ã‹ã£ãŸ': 40
  }[sleep_quality];

  // 3. ä¸­é€”è¦šé†’ã‚¹ã‚³ã‚¢ (20%)
  const awakeningsScore = Math.max(100 - (awakenings * 10), 0);

  // 4. å…¥çœ æ½œæ™‚ã‚¹ã‚³ã‚¢ (15%)
  const latencyScore = Math.max(100 - (sleep_latency - 15) * 2, 0);

  // 5. ç’°å¢ƒã‚¹ã‚³ã‚¢ (10%)
  const envScore = calculateEnvironmentScore(tags);

  // é‡ã¿ä»˜ã‘åˆè¨ˆ
  return Math.round(
    sleepTimeScore * 0.30 +
    deepSleepScore * 0.25 +
    awakeningsScore * 0.20 +
    latencyScore * 0.15 +
    envScore * 0.10
  );
}
```

**å‚ç…§**: [002-requirements_definition_v0.1.md](./002-requirements_definition_v0.1.md) ã‚»ã‚¯ã‚·ãƒ§ãƒ³4

---

### 2. ç¡çœ è¨˜éŒ²ç”»é¢UIå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/SleepTrackerScreen.tsx`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ï¼‰

**å®Ÿè£…å†…å®¹**:
- å°±å¯æ™‚é–“å…¥åŠ›: DateTimePickerï¼ˆHH:MMå½¢å¼ï¼‰
- èµ·åºŠæ™‚é–“å…¥åŠ›: DateTimePickerï¼ˆHH:MMå½¢å¼ï¼‰
- ä¸­é€”è¦šé†’å›æ•°: Number inputï¼ˆ0ï½10ï¼‰
- å…¥çœ æ½œæ™‚: Number inputï¼ˆåˆ†å˜ä½ï¼‰
- ã€Œè¨˜éŒ²ã™ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜

**è¿½åŠ ç®‡æ‰€**:
```typescript
export default function SleepTrackerScreen() {
  const [bedtime, setBedtime] = useState('22:00');
  const [waketime, setWaketime] = useState('07:00');
  const [awakenings, setAwakenings] = useState(0);
  const [sleepLatency, setSleepLatency] = useState(15);

  const handleSave = async () => {
    // database.ts ã® saveSleepRecord() ã‚’å‘¼ã³å‡ºã—
    const score = calculateSleepScore({...});
    await saveSleepRecord({ bedtime, waketime, score, ... });
  };

  return (
    <ScrollView>
      {/* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£… */}
    </ScrollView>
  );
}
```

---

### 3. ç¡çœ ç’°å¢ƒã‚¿ã‚°é¸æŠUIå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/SleepTrackerScreen.tsx`ï¼ˆä¸Šè¨˜ã«è¿½åŠ ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
const TAGS = [
  'é‹å‹•', 'ã‚«ãƒ•ã‚§ã‚¤ãƒ³ãªã—', 'å…¥æµ´', 'å®¤æ¸©é©æ­£',
  'ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãªã—', 'ã‚¹ãƒãƒ›åˆ¶é™', 'ç‘æƒ³', 'æ—©ã‚ã®å¤•é£Ÿ'
];

const [selectedTags, setSelectedTags] = useState<string[]>([]);

// ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã¾ãŸã¯ã‚¿ã‚°ãƒœã‚¿ãƒ³å½¢å¼ã§å®Ÿè£…
```

---

### 4. ç¡çœ è³ªé¸æŠUIå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/SleepTrackerScreen.tsx`ï¼ˆä¸Šè¨˜ã«è¿½åŠ ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
const [sleepQuality, setSleepQuality] = useState<'ã‚ˆãçœ ã‚ŒãŸ' | 'æ™®é€š' | 'æµ…ã‹ã£ãŸ'>('æ™®é€š');

// ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã¾ãŸã¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§å®Ÿè£…
<View style={styles.qualitySelector}>
  <TouchableOpacity onPress={() => setSleepQuality('ã‚ˆãçœ ã‚ŒãŸ')}>
    <Text>ğŸ˜Š ã‚ˆãçœ ã‚ŒãŸ</Text>
  </TouchableOpacity>
  {/* ä»–ã®é¸æŠè‚¢ã‚‚åŒæ§˜ */}
</View>
```

---

### 5. ç¡çœ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹CRUDæ“ä½œå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/database.ts`ï¼ˆå…±é€šã‚¿ã‚¹ã‚¯ã§åˆæœŸåŒ–å¾Œã«è¿½åŠ ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
// ç¡çœ è¨˜éŒ²ã‚’ä¿å­˜
export async function saveSleepRecord(record: Omit<SleepRecord, 'id'>) {
  const db = await openDatabase();
  await db.runAsync(
    `INSERT INTO sleep_records (date, bedtime, waketime, score, sleep_quality, awakenings, sleep_latency, tags)
     VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,
    [record.date, record.bedtime, record.waketime, record.score, record.sleep_quality,
     record.awakenings, record.sleep_latency, JSON.stringify(record.tags)]
  );
}

// æŒ‡å®šæ—¥ã®ç¡çœ è¨˜éŒ²ã‚’å–å¾—
export async function getSleepRecord(date: string): Promise<SleepRecord | null> {
  const db = await openDatabase();
  const result = await db.getFirstAsync<SleepRecord>(
    'SELECT * FROM sleep_records WHERE date = ?',
    [date]
  );
  return result;
}

// æœ€æ–°7æ—¥åˆ†ã®è¨˜éŒ²ã‚’å–å¾—ï¼ˆã‚°ãƒ©ãƒ•ç”¨ï¼‰
export async function getRecentSleepRecords(days: number = 7): Promise<SleepRecord[]> {
  const db = await openDatabase();
  const results = await db.getAllAsync<SleepRecord>(
    'SELECT * FROM sleep_records ORDER BY date DESC LIMIT ?',
    [days]
  );
  return results;
}
```

---

### 6. ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¹ã‚³ã‚¢è¡¨ç¤ºé€£æº

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/HomeScreen.tsx`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ï¼‰

**å¤‰æ›´å†…å®¹**:
```typescript
// ç¾åœ¨ã®ãƒ¢ãƒƒã‚¯å€¤ï¼ˆ82ç‚¹ï¼‰ã‚’å‰Šé™¤
// const sleepScore = 82;

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ä»Šæ—¥ã®ã‚¹ã‚³ã‚¢ã‚’å–å¾—
const [sleepScore, setSleepScore] = useState<number | null>(null);

useEffect(() => {
  const loadTodayScore = async () => {
    const today = new Date().toISOString().split('T')[0];
    const record = await getSleepRecord(today);
    setSleepScore(record?.score ?? null);
  };
  loadTodayScore();
}, []);

// ã‚¹ã‚³ã‚¢è¡¨ç¤ºéƒ¨åˆ†
{sleepScore !== null ? (
  <Text style={styles.scoreValue}>{sleepScore}</Text>
) : (
  <Text style={styles.noDataText}>æœªè¨˜éŒ²</Text>
)}
```

---

### 7. ç¡çœ æ—¥è¨˜ç”»é¢å®Ÿè£…ï¼ˆWeek 5-6ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/SleepDiaryScreen.tsx`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…å†…å®¹**:
- å¤¢ã®å†…å®¹: TextInputï¼ˆè¤‡æ•°è¡Œï¼‰
- ä¸å®‰ãƒ»å¿ƒé…äº‹: TextInputï¼ˆè¤‡æ•°è¡Œï¼‰
- ä»Šæ—¥ã®æ°—åˆ†: çµµæ–‡å­—é¸æŠ
- æ—¥è¨˜ä¸€è¦§è¡¨ç¤º: FlatList

```typescript
export default function SleepDiaryScreen() {
  const [dream, setDream] = useState('');
  const [mood, setMood] = useState('');

  const handleSave = async () => {
    const today = new Date().toISOString().split('T')[0];
    await updateSleepRecord(today, { dream, mood });
  };

  return (
    <View>
      <TextInput
        placeholder="è¦‹ãŸå¤¢ã‚’è¨˜éŒ²..."
        value={dream}
        onChangeText={setDream}
        multiline
      />
      {/* ä»–ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚åŒæ§˜ */}
    </View>
  );
}
```

---

### 8. AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ï¼ˆWeek 5-6ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/adviceGenerator.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
export function generateAdvice(score: number, sleepData: SleepRecord): string {
  // ã‚¹ã‚³ã‚¢åˆ¥ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒã‚¤ã‚¹
  if (score >= 80) {
    return 'ç´ æ™´ã‚‰ã—ã„ç¡çœ ã§ã™ï¼ã“ã®èª¿å­ã§è¦å‰‡æ­£ã—ã„ç”Ÿæ´»ã‚’ç¶šã‘ã¾ã—ã‚‡ã†ã€‚';
  } else if (score >= 60) {
    // ä½•ãŒä¸è¶³ã—ã¦ã„ã‚‹ã‹åˆ†æ
    if (sleepData.awakenings > 2) {
      return 'ä¸­é€”è¦šé†’ãŒå¤šã„ã‚ˆã†ã§ã™ã€‚å¯å®¤ã®æ¸©åº¦ã‚„ç…§æ˜ã‚’è¦‹ç›´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚';
    }
    // ä»–ã®æ¡ä»¶ã‚‚è¿½åŠ 
  } else {
    return 'ç¡çœ ã®è³ªãŒä½ä¸‹ã—ã¦ã„ã¾ã™ã€‚å°±å¯ãƒ»èµ·åºŠæ™‚åˆ»ã‚’ä¸€å®šã«ã™ã‚‹ã“ã¨ã‹ã‚‰å§‹ã‚ã¾ã—ã‚‡ã†ã€‚';
  }
}
```

---

### 9. ç¡çœ æ”¹å–„èª²é¡Œè‡ªå‹•æç¤ºãƒ­ã‚¸ãƒƒã‚¯

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/adviceGenerator.ts`ï¼ˆä¸Šè¨˜ã«è¿½åŠ ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
export async function getTodayMission(): Promise<string> {
  const db = await openDatabase();
  // daily_missions ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«1ä»¶å–å¾—
  const mission = await db.getFirstAsync<{mission_text: string}>(
    'SELECT mission_text FROM daily_missions ORDER BY RANDOM() LIMIT 1'
  );
  return mission?.mission_text ?? 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèª²é¡Œ';
}
```

**è¡¨ç¤ºå ´æ‰€**: `src/screens/HomeScreen.tsx`ï¼ˆæ—¢å­˜ã®ã€Œä»Šæ—¥ã®ã‚¿ã‚¹ã‚¯ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ ï¼‰

---

## ğŸ“ è—¤å·ã•ã‚“æ‹…å½“ã‚¿ã‚¹ã‚¯ï¼ˆã‚¿ã‚¹ã‚¯ç®¡ç†æ©Ÿèƒ½ï¼‰

### 1. ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢UIå®Ÿè£… â­ï¸æœ€å„ªå…ˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/TaskJournalScreen.tsx`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ï¼‰

**å®Ÿè£…å†…å®¹**:
- ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤º: FlatList
- ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ : TextInput + ãƒœã‚¿ãƒ³
- ã‚¿ã‚¹ã‚¯å‰Šé™¤ãƒœã‚¿ãƒ³
- ã‚¿ã‚¹ã‚¯å®Œäº†ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹

```typescript
export default function TaskJournalScreen() {
  const [tasks, setTasks] = useState<Task[]>([]);
  const [newTaskText, setNewTaskText] = useState('');

  useEffect(() => {
    loadTasks();
  }, []);

  const loadTasks = async () => {
    const today = new Date().toISOString().split('T')[0];
    const todayTasks = await getTasksByDate(today);
    setTasks(todayTasks);
  };

  const handleAddTask = async () => {
    if (newTaskText.trim()) {
      await addTask(newTaskText);
      setNewTaskText('');
      loadTasks();
    }
  };

  return (
    <View style={styles.container}>
      {/* ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ  */}
      <View style={styles.inputSection}>
        <TextInput
          placeholder="æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’å…¥åŠ›..."
          value={newTaskText}
          onChangeText={setNewTaskText}
        />
        <Button title="è¿½åŠ " onPress={handleAddTask} />
      </View>

      {/* ã‚¿ã‚¹ã‚¯ä¸€è¦§ */}
      <FlatList
        data={tasks}
        renderItem={({ item }) => (
          <TaskCard task={item} onComplete={handleCompleteTask} />
        )}
      />
    </View>
  );
}
```

---

### 2. ã‚¿ã‚¹ã‚¯è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/TaskJournalScreen.tsx`ï¼ˆä¸Šè¨˜ã«å«ã¾ã‚Œã‚‹ï¼‰

**å®Ÿè£…è©³ç´°**:
- TextInput: æœ€å¤§200æ–‡å­—
- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³: ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯
- è¿½åŠ å¾Œ: å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢ã€ãƒªã‚¹ãƒˆæ›´æ–°

---

### 3. ã‚¿ã‚¹ã‚¯ä¸€è¦§è¡¨ç¤ºå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/TaskJournalScreen.tsx`ï¼ˆä¸Šè¨˜ã«å«ã¾ã‚Œã‚‹ï¼‰

**å®Ÿè£…è©³ç´°**:
- FlatListä½¿ç”¨
- å„ã‚¢ã‚¤ãƒ†ãƒ : ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ + ã‚¿ã‚¹ã‚¯å + å‰Šé™¤ãƒœã‚¿ãƒ³
- å®Œäº†æ¸ˆã¿ã‚¿ã‚¹ã‚¯: ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆè¡¨ç¤º

---

### 4. æ„Ÿæƒ…é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£… â­ï¸é‡è¦

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/components/EmotionPicker.tsx`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
interface EmotionPickerProps {
  visible: boolean;
  onSelect: (emotion: string) => void;
  onClose: () => void;
}

export default function EmotionPicker({ visible, onSelect, onClose }: EmotionPickerProps) {
  const emotions = ['ğŸ˜Š', 'ğŸ˜Œ', 'ğŸ˜«', 'ğŸ˜¡', 'ğŸ˜­', 'ğŸ˜´'];

  return (
    <Modal visible={visible} transparent animationType="fade">
      <View style={styles.overlay}>
        <View style={styles.modalContent}>
          <Text style={styles.title}>ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã®æ°—åˆ†ã¯ï¼Ÿ</Text>
          <View style={styles.emotionGrid}>
            {emotions.map(emoji => (
              <TouchableOpacity
                key={emoji}
                onPress={() => {
                  onSelect(emoji);
                  onClose();
                }}
              >
                <Text style={styles.emotionButton}>{emoji}</Text>
              </TouchableOpacity>
            ))}
          </View>
        </View>
      </View>
    </Modal>
  );
}
```

---

### 5. ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚æ„Ÿæƒ…è¨˜éŒ²æ©Ÿèƒ½

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/TaskJournalScreen.tsx`ï¼ˆæ©Ÿèƒ½è¿½åŠ ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
const [showEmotionPicker, setShowEmotionPicker] = useState(false);
const [selectedTaskId, setSelectedTaskId] = useState<number | null>(null);

const handleCompleteTask = (taskId: number) => {
  setSelectedTaskId(taskId);
  setShowEmotionPicker(true);
};

const handleEmotionSelect = async (emotion: string) => {
  if (selectedTaskId) {
    await updateTaskStatus(selectedTaskId, 'done', emotion);
    loadTasks();
  }
};

// JSXå†…
<EmotionPicker
  visible={showEmotionPicker}
  onSelect={handleEmotionSelect}
  onClose={() => setShowEmotionPicker(false)}
/>
```

---

### 6. ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹CRUDæ“ä½œå®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/database.ts`ï¼ˆå…±é€šã‚¿ã‚¹ã‚¯ã§åˆæœŸåŒ–å¾Œã«è¿½åŠ ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
// ã‚¿ã‚¹ã‚¯è¿½åŠ 
export async function addTask(taskText: string): Promise<void> {
  const db = await openDatabase();
  const today = new Date().toISOString().split('T')[0];
  await db.runAsync(
    'INSERT INTO tasks (date, task, status) VALUES (?, ?, ?)',
    [today, taskText, 'todo']
  );
}

// æŒ‡å®šæ—¥ã®ã‚¿ã‚¹ã‚¯ä¸€è¦§å–å¾—
export async function getTasksByDate(date: string): Promise<Task[]> {
  const db = await openDatabase();
  const results = await db.getAllAsync<Task>(
    'SELECT * FROM tasks WHERE date = ? ORDER BY created_at ASC',
    [date]
  );
  return results;
}

// ã‚¿ã‚¹ã‚¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ï¼ˆå®Œäº†+æ„Ÿæƒ…è¨˜éŒ²ï¼‰
export async function updateTaskStatus(
  taskId: number,
  status: 'todo' | 'done',
  emotion?: string
): Promise<void> {
  const db = await openDatabase();
  await db.runAsync(
    'UPDATE tasks SET status = ?, emotion = ? WHERE id = ?',
    [status, emotion ?? null, taskId]
  );
}

// ã‚¿ã‚¹ã‚¯å‰Šé™¤
export async function deleteTask(taskId: number): Promise<void> {
  const db = await openDatabase();
  await db.runAsync('DELETE FROM tasks WHERE id = ?', [taskId]);
}
```

---

### 7. ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã€Œã‚¹ãƒªãƒ¼ãƒ”ãƒ³ã€è¡¨æƒ…å¤‰åŒ–å®Ÿè£…ï¼ˆWeek 5-6ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/HomeScreen.tsx`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
// ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦çµµæ–‡å­—ã‚’å¤‰æ›´
function getCharacterEmoji(score: number | null): string {
  if (score === null) return 'ğŸ˜´'; // æœªè¨˜éŒ²
  if (score >= 80) return 'ğŸ˜Š'; // è‰¯ã„ç¡çœ 
  if (score >= 60) return 'ğŸ˜Œ'; // æ™®é€š
  if (score >= 40) return 'ğŸ˜«'; // ã‚„ã‚„æ‚ªã„
  return 'ğŸ˜­'; // æ‚ªã„
}

// æ—¢å­˜ã®characterEmojiã‚’å‹•çš„ã«å¤‰æ›´
const characterEmoji = getCharacterEmoji(sleepScore);
```

**è¿½åŠ **: ã‚¹ã‚³ã‚¢å¤‰åŒ–æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

### 8. ãƒ›ãƒ¼ãƒ ç”»é¢èƒŒæ™¯å¤‰åŒ–å®Ÿè£…ï¼ˆWeek 5-6ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/screens/HomeScreen.tsx`ï¼ˆæ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
// ã‚¹ã‚³ã‚¢ã«å¿œã˜ã¦èƒŒæ™¯è‰²ã‚’å¤‰æ›´
function getBackgroundStyle(score: number | null): ViewStyle {
  if (score === null) return { backgroundColor: Colors.background };
  if (score >= 80) return { backgroundColor: '#FFF9E6' }; // æœæ—¥ï¼ˆé»„è‰²ç³»ï¼‰
  if (score >= 60) return { backgroundColor: '#E6F2FF' }; // æ™´å¤©ï¼ˆé’ç³»ï¼‰
  if (score >= 40) return { backgroundColor: '#F0F0F0' }; // æ›‡ã‚Šï¼ˆç°è‰²ç³»ï¼‰
  return { backgroundColor: '#1E293B' }; // å¤œï¼ˆæš—è‰²ç³»ï¼‰
}

// ã‚³ãƒ³ãƒ†ãƒŠã‚¹ã‚¿ã‚¤ãƒ«ã«é©ç”¨
<ScrollView style={[styles.container, getBackgroundStyle(sleepScore)]}>
```

**è¿½åŠ **: å¤ªé™½/æœˆã®ã‚¢ã‚¤ã‚³ãƒ³è¡¨ç¤ºï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## ğŸ”§ å…±é€šã‚¿ã‚¹ã‚¯ï¼ˆä¸¡è€…ã§å”åŠ›ï¼‰

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ â­ï¸æœ€å„ªå…ˆ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/services/database.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
import * as SQLite from 'expo-sqlite';

let db: SQLite.SQLiteDatabase | null = null;

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’é–‹ã
export async function openDatabase(): Promise<SQLite.SQLiteDatabase> {
  if (db) return db;

  db = await SQLite.openDatabaseAsync('mindful_rhythm.db');
  await initializeDatabase();
  return db;
}

// å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ
async function initializeDatabase(): Promise<void> {
  if (!db) return;

  // 1. sleep_records ãƒ†ãƒ¼ãƒ–ãƒ«
  await db.execAsync(`
    CREATE TABLE IF NOT EXISTS sleep_records (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      date TEXT NOT NULL UNIQUE,
      bedtime TEXT NOT NULL,
      waketime TEXT NOT NULL,
      total_hours REAL,
      score INTEGER,
      sleep_quality TEXT CHECK (sleep_quality IN ('ã‚ˆãçœ ã‚ŒãŸ', 'æ™®é€š', 'æµ…ã‹ã£ãŸ')),
      awakenings INTEGER DEFAULT 0,
      sleep_latency INTEGER,
      tags TEXT,
      dream TEXT,
      mood TEXT,
      created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),
      updated_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))
    );
    CREATE INDEX IF NOT EXISTS idx_sleep_date ON sleep_records(date DESC);
  `);

  // 2. tasks ãƒ†ãƒ¼ãƒ–ãƒ«
  await db.execAsync(`
    CREATE TABLE IF NOT EXISTS tasks (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      date TEXT NOT NULL,
      task TEXT NOT NULL CHECK (length(task) >= 1 AND length(task) <= 200),
      status TEXT CHECK (status IN ('todo', 'done')) DEFAULT 'todo',
      emotion TEXT,
      is_daily_mission BOOLEAN DEFAULT 0,
      created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),
      updated_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))
    );
    CREATE INDEX IF NOT EXISTS idx_tasks_date ON tasks(date DESC);
  `);

  // 3. user_mood ãƒ†ãƒ¼ãƒ–ãƒ«
  await db.execAsync(`
    CREATE TABLE IF NOT EXISTS user_mood (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      date TEXT NOT NULL UNIQUE,
      morning_mood TEXT,
      night_mood TEXT,
      created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now')),
      updated_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))
    );
    CREATE INDEX IF NOT EXISTS idx_user_mood_date ON user_mood(date DESC);
  `);

  // 4. ai_advice ãƒ†ãƒ¼ãƒ–ãƒ«
  await db.execAsync(`
    CREATE TABLE IF NOT EXISTS ai_advice (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      date TEXT NOT NULL,
      advice_text TEXT NOT NULL,
      advice_type TEXT CHECK (advice_type IN ('breathing', 'bgm', 'stretch', 'sleep_hygiene')),
      created_at INTEGER NOT NULL DEFAULT (strftime('%s', 'now'))
    );
    CREATE INDEX IF NOT EXISTS idx_ai_advice_date ON ai_advice(date DESC);
  `);

  // 5. daily_missions ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰
  await db.execAsync(`
    CREATE TABLE IF NOT EXISTS daily_missions (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      mission_text TEXT NOT NULL UNIQUE,
      category TEXT CHECK (category IN ('sleep_hygiene', 'exercise', 'relaxation', 'environment'))
    );
  `);

  // åˆæœŸãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆåˆå›ã®ã¿ï¼‰
  const count = await db.getFirstAsync<{count: number}>('SELECT COUNT(*) as count FROM daily_missions');
  if (count?.count === 0) {
    await db.execAsync(`
      INSERT INTO daily_missions (mission_text, category) VALUES
      ('å¯ã‚‹1æ™‚é–“å‰ã¯ã‚¹ãƒãƒ›ãƒ»PCç¦æ­¢', 'sleep_hygiene'),
      ('ã‚«ãƒ•ã‚§ã‚¤ãƒ³ã¯15æ™‚ä»¥é™æ‘‚å–ã—ãªã„', 'sleep_hygiene'),
      ('å°±å¯2æ™‚é–“å‰ã«è»½ã„é‹å‹•ï¼ˆã‚¹ãƒˆãƒ¬ãƒƒãƒãƒ»æ•£æ­©ï¼‰', 'exercise'),
      ('å¯å®¤ã®æ¸©åº¦ã‚’18ï½22â„ƒã«ä¿ã¤', 'environment'),
      ('å°±å¯å‰ã«å…¥æµ´ï¼ˆ38ï½40â„ƒã€15åˆ†ï¼‰', 'relaxation'),
      ('æ¯æ—¥åŒã˜æ™‚åˆ»ã«å°±å¯ãƒ»èµ·åºŠã™ã‚‹', 'sleep_hygiene'),
      ('æ˜¼å¯ã¯15åˆ†ä»¥å†…ã€15æ™‚å‰ã«æ¸ˆã¾ã›ã‚‹', 'sleep_hygiene'),
      ('å¯å®¤ã‚’æš—ãé™ã‹ã«ä¿ã¤ï¼ˆé®å…‰ã‚«ãƒ¼ãƒ†ãƒ³ãƒ»è€³æ “ï¼‰', 'environment'),
      ('å°±å¯å‰ã«ãƒªãƒ©ã‚¯ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ·±å‘¼å¸ãƒ»ç‘æƒ³ï¼‰', 'relaxation'),
      ('å¯ã‚‹å‰ã«ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãƒ»ã‚¿ãƒã‚³ã‚’é¿ã‘ã‚‹', 'sleep_hygiene');
    `);
  }

  console.log('âœ… Database initialized successfully');
}

// App.tsx ã® useEffect ã§å‘¼ã³å‡ºã™
// useEffect(() => { openDatabase(); }, []);
```

---

### 2. æ—¥ä»˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£å®Ÿè£…

**ãƒ•ã‚¡ã‚¤ãƒ«**: `src/utils/dateFormatter.ts`ï¼ˆæ–°è¦ä½œæˆï¼‰

**å®Ÿè£…å†…å®¹**:
```typescript
// YYYY-MM-DD å½¢å¼ã«å¤‰æ›
export function formatDate(date: Date): string {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}

// HH:MM å½¢å¼ã«å¤‰æ›
export function formatTime(date: Date): string {
  const hours = String(date.getHours()).padStart(2, '0');
  const minutes = String(date.getMinutes()).padStart(2, '0');
  return `${hours}:${minutes}`;
}

// "22:30" ã‹ã‚‰ Date ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
export function parseTime(timeString: string): Date {
  const [hours, minutes] = timeString.split(':').map(Number);
  const date = new Date();
  date.setHours(hours, minutes, 0, 0);
  return date;
}

// 2ã¤ã®æ™‚åˆ»é–“ã®å·®åˆ†ï¼ˆæ™‚é–“å˜ä½ï¼‰
export function calculateHoursDifference(bedtime: string, waketime: string): number {
  const bed = parseTime(bedtime);
  const wake = parseTime(waketime);

  // æ—¥ã‚’ã¾ãŸãå ´åˆã®å‡¦ç†
  if (wake < bed) {
    wake.setDate(wake.getDate() + 1);
  }

  const diffMs = wake.getTime() - bed.getTime();
  return diffMs / (1000 * 60 * 60); // ãƒŸãƒªç§’ â†’ æ™‚é–“
}

// ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—
export function getToday(): string {
  return formatDate(new Date());
}
```

---

### 3. çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:
1. ç¡çœ è¨˜éŒ²ã‚’å…¥åŠ›ï¼ˆå°±å¯22:30ã€èµ·åºŠ07:00ã€ã‚ˆãçœ ã‚ŒãŸã€è¦šé†’0å›ã€å…¥çœ 15åˆ†ã€ã‚¿ã‚°3ã¤ï¼‰
2. ã‚¹ã‚³ã‚¢ãŒè‡ªå‹•è¨ˆç®—ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªï¼ˆæœŸå¾…å€¤: 85ï½95ç‚¹ï¼‰
3. ãƒ›ãƒ¼ãƒ ç”»é¢ã«ä»Šæ—¥ã®ã‚¹ã‚³ã‚¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
4. ã‚¿ã‚¹ã‚¯ã‚’3ã¤è¿½åŠ 
5. ã‚¿ã‚¹ã‚¯ã‚’1ã¤å®Œäº† â†’ æ„Ÿæƒ…é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤º
6. æ„Ÿæƒ…ã‚’é¸æŠ â†’ ã‚¿ã‚¹ã‚¯ãŒã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
7. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèªï¼ˆsleep_records, tasks ã«ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ï¼‰

**å®Ÿæ–½æ–¹æ³•**:
- Expo Go ã‚¢ãƒ—ãƒªã§å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆ
- iOSã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§å‹•ä½œç¢ºèª
- console.log ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å†…å®¹ç¢ºèª

---

## ğŸ“… å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ¨å¥¨

### Week 3ï¼ˆ11æœˆç¬¬1é€±ï¼‰

**å¢—ç”°ã•ã‚“**:
- [ ] ç¡çœ ã‚¹ã‚³ã‚¢ç®—å‡ºãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼ˆè—¤å·ã•ã‚“ã¨å”åŠ›ï¼‰
- [ ] ç¡çœ è¨˜éŒ²ç”»é¢UIå®Ÿè£…ï¼ˆåŸºæœ¬ãƒ•ã‚©ãƒ¼ãƒ ï¼‰

**è—¤å·ã•ã‚“**:
- [ ] ã‚¿ã‚¹ã‚¯ç®¡ç†ç”»é¢UIå®Ÿè£…
- [ ] æ„Ÿæƒ…é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«å®Ÿè£…
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼ˆå¢—ç”°ã•ã‚“ã¨å”åŠ›ï¼‰

---

### Week 4ï¼ˆ11æœˆç¬¬2é€±ï¼‰

**å¢—ç”°ã•ã‚“**:
- [ ] ç¡çœ ç’°å¢ƒã‚¿ã‚°é¸æŠUIå®Ÿè£…
- [ ] ç¡çœ è³ªé¸æŠUIå®Ÿè£…
- [ ] ç¡çœ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹CRUDæ“ä½œå®Ÿè£…
- [ ] ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¹ã‚³ã‚¢è¡¨ç¤ºé€£æº

**è—¤å·ã•ã‚“**:
- [ ] ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚æ„Ÿæƒ…è¨˜éŒ²æ©Ÿèƒ½
- [ ] ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹CRUDæ“ä½œå®Ÿè£…
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½ï¼ˆå…±é€šï¼‰

---

### Week 5-6ï¼ˆ11æœˆç¬¬3-4é€±ï¼‰

**å¢—ç”°ã•ã‚“**:
- [ ] ç¡çœ æ—¥è¨˜ç”»é¢å®Ÿè£…
- [ ] AIã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…
- [ ] ç¡çœ æ”¹å–„èª²é¡Œè‡ªå‹•æç¤ºãƒ­ã‚¸ãƒƒã‚¯

**è—¤å·ã•ã‚“**:
- [ ] ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¡¨æƒ…å¤‰åŒ–å®Ÿè£…
- [ ] ãƒ›ãƒ¼ãƒ ç”»é¢èƒŒæ™¯å¤‰åŒ–å®Ÿè£…
- [ ] UI/UXãƒ–ãƒ©ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—

---

## ğŸ”— å‚è€ƒãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [è¦ä»¶å®šç¾©æ›¸](./002-requirements_definition_v0.1.md) - å…¨æ©Ÿèƒ½ã®è©³ç´°ä»•æ§˜
- [Expo SQLite ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.expo.dev/versions/latest/sdk/sqlite/)
- [React Navigation ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://reactnavigation.org/docs/getting-started)
- [TypeScriptå‹å®šç¾©](../src/types/database.ts) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹å®šç¾©
- [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé€²æ—ç®¡ç†](./TodoList.md) - å…¨ä½“é€²æ—

---

## â“ å›°ã£ãŸã¨ãã®é€£çµ¡å…ˆ

- **æŠ€è¡“çš„ãªè³ªå•**: ç«‹å·ã•ã‚“ï¼ˆReact Nativeå®Ÿè£…ï¼‰
- **è¨­è¨ˆãƒ»ä»•æ§˜ã®è³ªå•**: å¢—ç”°ã•ã‚“ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ï¼‰
- **UI/UXã®ç›¸è«‡**: è—¤å·ã•ã‚“ï¼ˆãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ï¼‰
- **AIæ´»ç”¨**: ChatGPT/Claude ã«è³ªå•ï¼ˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆãƒ»ãƒ‡ãƒãƒƒã‚°æ”¯æ´ï¼‰

---

## âœ… ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

å®Ÿè£…å‰ã«ç¢ºèª:
- [ ] ç’°å¢ƒæ§‹ç¯‰å®Œäº†ï¼ˆnpm install æˆåŠŸï¼‰
- [ ] ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã™ã‚‹ï¼ˆnpm start â†’ Expo Go ã§è¡¨ç¤ºï¼‰
- [ ] æ—¢å­˜ã®HomeScreen.tsxãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] Git ã®ãƒ–ãƒ©ãƒ³ãƒä½œæˆï¼ˆfeature/sleep-tracking, feature/task-managementï¼‰

å®Ÿè£…å¾Œã«ç¢ºèª:
- [ ] TypeScriptã‚¨ãƒ©ãƒ¼ãªã—ï¼ˆnpm run lintï¼‰
- [ ] å®Ÿæ©Ÿã§UIç¢ºèªï¼ˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œãªã—ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜ç¢ºèªï¼ˆconsole.log ã§ãƒ‡ãƒ¼ã‚¿ç¢ºèªï¼‰
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªå®Ÿæ–½ï¼ˆå…¨æ©Ÿèƒ½é€£æºå‹•ä½œï¼‰

---

**ä½œæˆè€…**: Claude AI
**æœ€çµ‚æ›´æ–°**: 2025å¹´10æœˆ30æ—¥
